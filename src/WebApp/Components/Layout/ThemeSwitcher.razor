@inject IJSRuntime JS
@implements IAsyncDisposable

<button @onclick="HandleToggleClick" class="mode-switcher" aria-label="Toggle display mode" title="Switch between light and dark mode">
    @if (isDarkMode)
    {
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <circle cx="10" cy="10" r="4" fill="currentColor"/>
            <line x1="10" y1="1" x2="10" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="10" y1="17" x2="10" y2="19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="1" y1="10" x2="3" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="17" y1="10" x2="19" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="3.5" y1="3.5" x2="5" y2="5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="15" y1="15" x2="16.5" y2="16.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="16.5" y1="3.5" x2="15" y2="5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="5" y1="15" x2="3.5" y2="16.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
    }
    else
    {
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M17 10.5C16.1 14.8 12.3 18 8 18C3.6 18 0 14.4 0 10C0 5.7 3.2 1.9 7.5 1C6.6 2.1 6 3.5 6 5C6 8.3 8.7 11 12 11C13.5 11 14.9 10.4 16 9.5C16.6 9.8 16.8 10.1 17 10.5Z" fill="currentColor"/>
        </svg>
    }
</button>

@code {
    private bool isDarkMode;
    private IJSObjectReference? jsModule;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            jsModule = await JS.InvokeAsync<IJSObjectReference>("import", "./Components/Layout/ThemeSwitcher.razor.js");
            isDarkMode = await jsModule.InvokeAsync<bool>("loadSavedPreference");
            StateHasChanged();
        }
    }

    private async Task HandleToggleClick()
    {
        if (jsModule is not null)
        {
            isDarkMode = !isDarkMode;
            await jsModule.InvokeVoidAsync("applyModeChange", isDarkMode);
        }
    }

    async ValueTask IAsyncDisposable.DisposeAsync()
    {
        if (jsModule is not null)
        {
            await jsModule.DisposeAsync();
        }
    }
}
